import{i as e,d as t,r as a,u as n,c as l,w as r,o,a as u,b as s,e as i,f as c,g as f,N as d,h as v,j as p,k as m,F as h,l as g,m as y,n as k,p as _,q as $,s as b,t as w,v as I,x,y as N,z as j,A as L,B as S,C as O,D as R,E as U,G as C,H as T,I as z,J as A,K as B,L as D,M as E,O as K}from"./vendor.a06374fb.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const M=[[0,0,0],[255,255,255],[170,170,170],[85,85,85],[254,211,199],[255,196,206],[250,172,142],[255,139,131],[244,67,54],[233,30,99],[226,102,158],[156,39,176],[103,58,183],[63,81,181],[0,70,112],[5,113,151],[33,150,243],[0,188,212],[59,229,219],[151,253,220],[22,115,0],[55,169,60],[137,230,66],[215,255,7],[255,246,209],[248,203,140],[255,235,59],[255,193,7],[255,152,0],[255,87,34],[184,63,39],[121,85,72]];var q=(e,t)=>{const a=e.__vccOpts||e;for(const[n,l]of t)a[n]=l;return a};const F=e=>(R("data-v-4a93f448"),e=e(),U(),e),J=O(" 服务器 "),P=O(" 文件 "),G={key:0},H=O("服务器地址（不带 "),Q=F((()=>b("code",null,"/file",-1))),V=O(" 等路径）"),W={key:1},X=["width","height"],Y=O(" 复制这一行添加到客户端配置文件即可： "),Z=F((()=>b("br",null,null,-1))),ee=O(" 复制 ");var te=q(t({setup(t){const R=a("server"),U=a(""),z=["luogu-motaki","luogu-motaki-plan-editor","luogu-motaki-plan-preview","luogu-motaki-server","luogu-motaki-client"],A=a(!1),B=a(null),D=a(null),E=n(),K=a([]),q=[{title:"名称",key:"name"},{title:"左上坐标",key:"leftTop"},{title:"右下坐标",key:"rightBottom"},{title:"大小",key:"size"}],F=l((()=>"file"===R.value?q:[{type:"selection"}].concat(q)));function te(t){var a;if("object"!=typeof t||null===t||!function(e){for(const t of Object.values(e)){if("number"!=typeof(null==t?void 0:t.x))return!1;if("number"!=typeof(null==t?void 0:t.y))return!1;if("string"!=typeof(null==t?void 0:t.data))return!1}return!0}(t))return void E.error("Invalid plan format");const n=function(t){const a={};for(const[n,{x:l,y:r,data:o}]of Object.entries(t)){if(/\s/.test(n))return`task name [${n}] contains white space(s)`;const t=`task [${n}]: `;if(!Number.isSafeInteger(l)||!Number.isSafeInteger(r))return`${t}coordinate is not integer`;if(!e(l,0,1e3)||!e(r,0,600))return`${t}coordinate out of range`;const u=o.split("\n"),s=u.length;if(0===s||l+s>1e3)return`${t}image out of x range`;const i=u[0].length;if(0===i||r+i>600)return`${t}image out of y range`;for(let e=l;e<l+s;e+=1){if(u[e-l].length!==i)return`${t}data has different height in each column`;for(let n=r;n<r+i;n+=1){if(Number.isNaN(parseInt(u[e-l][n-r],32)))return`${t}data contains invalid character`;const o=600*e+n;if(a[o])return`${t}overlaps with another task`;a[o]=!0}}}return!0}(t);!0!==n&&E.error(`Invalid plan: ${n}`),K.value=[];const l=null==(a=D.value)?void 0:a.getContext("2d");if(!l)return;const r=l.createImageData(1e3,600);Object.entries(t).forEach((([e,{x:t,y:a,data:n}])=>{const l=n.split("\n"),o=l.length,u=l[0].length;K.value.push({name:e,leftTop:`(${t}, ${a})`,rightBottom:`(${t+o-1}, ${a+u-1})`,size:`${o} x ${u} = ${o*u}`});for(let s=0;s<o;s+=1)for(let e=0;e<u;e+=1){const n=parseInt(l[s][e],32),o=t+s+1e3*(a+e);for(let e=0;e<3;e+=1)r.data[4*o+e]=M[n][e];r.data[4*o+3]=255}})),l.putImageData(r,0,0),A.value=!0}function ae(){var e,t;A.value=!1;const a=null==(t=null==(e=B.value)?void 0:e.files)?void 0:t[0];if(a){const e=new FileReader;e.onload=()=>{const{result:t}=e;if("string"==typeof t){te(JSON.parse(t))}},e.readAsText(a)}}function ne(){A.value=!1,U.value.length<3?E.error("Server URL too short"):C.get(`${U.value.trim()}/plan`).then((e=>{if(200===e.status){const{data:t}=e;te(t)}})).catch((e=>{E.error(e.toString())}))}r([R],(()=>{var e,t;A.value=!1,"file"===R.value?(null==(t=null==(e=B.value)?void 0:e.files)?void 0:t.length)&&ae():U.value&&ne()})),o((()=>{const e=new URLSearchParams(window.location.search).get("server");e&&(U.value=e,ne())}));const le=a([]);function re(e){le.value=e}const oe=l((()=>{const e=le.value.map((e=>e.toString()));return`${U.value} ${e.join(" ")}`}));function ue(){navigator.clipboard.writeText(oe.value).then((()=>{E.success("复制成功")})).catch((e=>E.error(`复制失败: ${e}`)))}return(e,t)=>(u(),s(f(v),{id:"main",vertical:""},{default:i((()=>[c(f(d),{title:"Luogu Motaki 计划预览"}),c(f(g),{title:"Repositories"},{default:i((()=>[c(f(v),null,{default:i((()=>[(u(),p(h,null,m(z,(e=>c(f(T),{key:e,href:`https://github.com/ouuan/${e}`},{default:i((()=>[O(j(e),1)])),_:2},1032,["href"]))),64))])),_:1})])),_:1}),c(f(g),{title:"方案"},{default:i((()=>[c(f(v),{vertical:""},{default:i((()=>[c(f(y),{value:R.value,"onUpdate:value":t[0]||(t[0]=e=>R.value=e),name:"type"},{default:i((()=>[c(f(v),null,{default:i((()=>[c(f(k),{value:"server"},{default:i((()=>[J])),_:1}),c(f(k),{value:"file"},{default:i((()=>[P])),_:1})])),_:1})])),_:1},8,["value"]),"server"===R.value?(u(),p("div",G,[c(f(_),null,{default:i((()=>[H,Q,V])),_:1}),c(f($),{value:U.value,"onUpdate:value":t[1]||(t[1]=e=>U.value=e),type:"text",placeholder:"https://example.com","on-change":ne},null,8,["value"])])):(u(),p("div",W,[b("input",{ref_key:"fileInput",ref:B,type:"file",name:"motaki-plan",accept:"application/json",onChange:ae},null,544)]))])),_:1})])),_:1}),w(c(f(g),{title:"预览"},{default:i((()=>[c(f(v),{justify:"space-around"},{default:i((()=>[b("canvas",{ref_key:"canvas",ref:D,width:f(1e3),height:f(600)},null,8,X)])),_:1})])),_:1},512),[[I,A.value]]),A.value?(u(),s(f(g),{key:0,title:"server"===R.value?"选择以添加至客户端（不选相当于全选）":"任务列表"},{default:i((()=>[c(f(v),{vertical:""},{default:i((()=>[c(f(x),{data:K.value,columns:f(F),"row-key":e=>e.name,"onUpdate:checkedRowKeys":re},null,8,["data","columns","row-key"]),"server"===R.value?(u(),s(f(N),{key:0},{default:i((()=>[Y,Z,c(f(v),null,{default:i((()=>[b("pre",null,j(f(oe)),1),c(f(L),{type:"primary",onClick:ue},{default:i((()=>[ee])),_:1})])),_:1})])),_:1})):S("",!0)])),_:1})])),_:1},8,["title"])):S("",!0)])),_:1}))}}),[["__scopeId","data-v-4a93f448"]]);K(t({setup(e){const t=l((()=>"dark"===D().value?E:null));return(e,a)=>(u(),s(f(z),{theme:f(t)},{default:i((()=>[c(f(A)),c(f(B),{closable:!0,"keep-alive-on-hover":!0,duration:5e3},{default:i((()=>[c(te)])),_:1})])),_:1},8,["theme"]))}})).mount("#app");
